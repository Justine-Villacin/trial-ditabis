<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Sign Up - LearnSync</title>
   <link rel="stylesheet" href="{{ url_for('static', filename='css/login.css') }}">
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
   <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@600;700&display=swap" rel="stylesheet">
   </head>
<body>
   <a href="/" class="back-to-home">
      <i class="fas fa-arrow-left"></i>
      <span>Back to Home</span>
   </a>

   <div class="signup-container">
      <h1>LearnSync</h1>
      <p class="subtitle">Create your account to get started.</p>

      <div class="flash-messages">
         {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                  {% for category, message in messages %}
                     <div class="flash-message {{ category }}">
                        {{ message }}
                     </div>
                  {% endfor %}
            {% endif %}
         {% endwith %}
      </div>

      <div class="user-type-selection">
         <label>Select Account Type</label>
         <div class="radio-group">
            <input type="radio" id="student" name="userType" value="student" checked>
            <label for="student">
               <i class="fas fa-user-graduate"></i>
               Student
            </label>
            <input type="radio" id="professor" name="userType" value="professor">
            <label for="professor">
               <i class="fas fa-chalkboard-teacher"></i>
               Professor
            </label>
         </div>
      </div>

      <form method="POST" action="/signup" id="signupForm">
         <input type="hidden" name="userType" id="userTypeInput" value="student">
         
         <div class="name-fields">
            <div class="input-group">
               <i class="icon fas fa-user"></i>
               <input type="text" id="firstName" name="firstName" placeholder="First Name" required>
            </div>

            <div class="input-group">
               <i class="icon fas fa-user"></i>
               <input type="text" id="lastName" name="lastName" placeholder="Last Name" required>
            </div>
         </div>

         <div class="input-group">
            <i class="icon fas fa-envelope"></i>
            <input type="email" id="email" name="email" placeholder="Email address" required>
         </div>

         <div id="studentFields">
            <div class="input-group">
               <i class="icon fas fa-id-card"></i>
               <input type="text" id="studentId" name="studentId" placeholder="Student ID" required>
            </div>

            <div class="input-group">
               <i class="icon fas fa-book"></i>
               <input type="text" id="course" name="course" placeholder="Course/Program" required>
            </div>

            <div class="input-group">
               <i class="icon fas fa-calendar-alt"></i>
               <select id="yearLevel" name="yearLevel" required>
                  <option value="">Select Year Level</option>
                  <option value="1st Year">1st Year</option>
                  <option value="2nd Year">2nd Year</option>
                  <option value="3rd Year">3rd Year</option>
                  <option value="4th Year">4th Year</option>
               </select>
            </div>
         </div>

         <div id="professorFields" style="display: none;">
            <div class="input-group">
               <i class="icon fas fa-id-badge"></i>
               <input type="text" id="professorId" name="professorId" placeholder="Professor ID">
            </div>

            <div class="input-group">
               <i class="icon fas fa-building"></i>
               <input type="text" id="department" name="department" placeholder="Department">
            </div>
         </div>

         <div class="input-group">
            <i class="icon fas fa-lock"></i>
            <input type="password" id="password" name="password" placeholder="Password" required>
            <button type="button" 
                     onclick="togglePasswordVisibility('password', this)" 
                     class="password-toggle">
               <i class="fas fa-eye"></i>
            </button>
         </div>

         <div class="input-group">
            <i class="icon fas fa-lock"></i>
            <input type="password" id="confirmPassword" name="confirmPassword" placeholder="Confirm Password" required>
            <button type="button" 
                     onclick="togglePasswordVisibility('confirmPassword', this)" 
                     class="password-toggle">
               <i class="fas fa-eye"></i>
            </button>
         </div>
         
         <div class="password-strength" id="passwordStrength">
            <div class="password-strength-bar"></div>
         </div>
         
         <div class="checkbox-group">
            <input type="checkbox" name="policy" id="policy" required>
            <label for="policy">
               I agree to the <a href="/terms" target="_blank">Terms & Conditions</a> and <a href="/privacy" target="_blank">Privacy Policy</a>
            </label>
         </div>

         <button class="signup-btn" type="submit">Create Account</button>

         <div class="login-redirect">
            Already have an account? <a href="/login">Log in</a>
         </div>
      </form>
   </div>

   <script>
      document.addEventListener('DOMContentLoaded', function() {
         const studentRadio = document.getElementById('student');
         const professorRadio = document.getElementById('professor');
         const studentFields = document.getElementById('studentFields');
         const professorFields = document.getElementById('professorFields');
         const userTypeInput = document.getElementById('userTypeInput');
         const signupForm = document.getElementById('signupForm');
         const signupBtn = signupForm.querySelector('.signup-btn');
         const passwordInput = document.getElementById('password');
         const confirmPasswordInput = document.getElementById('confirmPassword');
         const passwordStrength = document.getElementById('passwordStrength');

         // Toggle between student and professor fields
         function toggleFields() {
            if (studentRadio.checked) {
               studentFields.style.display = 'block';
               professorFields.style.display = 'none';
               userTypeInput.value = 'student';
               
               // Set required attributes for student fields
               document.getElementById('studentId').required = true;
               document.getElementById('course').required = true;
               document.getElementById('yearLevel').required = true;
               
               // Remove required from professor fields
               document.getElementById('professorId').required = false;
               document.getElementById('department').required = false;
            } else {
               studentFields.style.display = 'none';
               professorFields.style.display = 'block';
               userTypeInput.value = 'professor';
               
               // Remove required from student fields
               document.getElementById('studentId').required = false;
               document.getElementById('course').required = false;
               document.getElementById('yearLevel').required = false;
               
               // Set required attributes for professor fields
               document.getElementById('professorId').required = true;
               document.getElementById('department').required = true;
            }
         }

         studentRadio.addEventListener('change', toggleFields);
         professorRadio.addEventListener('change', toggleFields);
         
         // Initialize
         toggleFields();

         // Password strength indicator
         passwordInput.addEventListener('input', function() {
            const password = this.value;
            
            if (password.length === 0) {
               passwordStrength.style.display = 'none';
               passwordStrength.className = 'password-strength';
               return;
            }

            passwordStrength.style.display = 'block';

            let strength = 0;
            
            // Length check
            if (password.length >= 8) strength++;
            if (password.length >= 12) strength++;
            
            // Character variety checks
            if (/[a-z]/.test(password) && /[A-Z]/.test(password)) strength++;
            if (/\d/.test(password)) strength++;
            if (/[^A-Za-z0-9]/.test(password)) strength++;

            // Set strength class
            if (strength <= 2) {
               passwordStrength.className = 'password-strength weak';
            } else if (strength <= 4) {
               passwordStrength.className = 'password-strength medium';
            } else {
               passwordStrength.className = 'password-strength strong';
            }
         });

         // Password confirmation validation
         confirmPasswordInput.addEventListener('input', function() {
            if (this.value !== passwordInput.value) {
               this.setCustomValidity('Passwords do not match');
            } else {
               this.setCustomValidity('');
            }
         });

         // Form submit loading state
         signupForm.addEventListener('submit', function(e) {
            if (passwordInput.value !== confirmPasswordInput.value) {
               e.preventDefault();
               alert('Passwords do not match. Please try again.');
               return;
            }
            
            signupBtn.classList.add('loading');
            signupBtn.textContent = ''; // Text is hidden by CSS rule
         });
      });

      function togglePasswordVisibility(inputId, button) {
         const input = document.getElementById(inputId);
         const icon = button.querySelector('i');
         
         if (input.type === 'password') {
            input.type = 'text';
            icon.className = 'fas fa-eye-slash';
         } else {
            input.type = 'password';
            icon.className = 'fas fa-eye';
         }
      }
   </script>
</body>
</html>